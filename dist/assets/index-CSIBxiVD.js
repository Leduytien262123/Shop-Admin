import{_ as S}from"./CommonPage-r69Mp4tc.js";import{c as u,af as H,d as I,o as O,e as s,Z as T,u as P,j as n,ah as A,W as E,l as y,aj as W,a8 as Z,a9 as q,g as k,at as F,E as d,h as D,ak as J,al as w,an as ee,p as m,am as te,O as ae}from"./index-DYcU_f0W.js";import{_ as ne}from"./ModalDetail-DGX9te_j.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TheFooter-BtZThfEk.js";import"./AppCard-kEEXouea.js";const se={class:"flex justìy-end gap-12"},ie={class:"flex gap-12 mb-8 items-end"},ue=Object.assign({name:"CouponManagement"},{__name:"index",setup(oe){const $=P(),M=u([]),r=u(!1),a=u({search:null,type:null,status:null}),B=u(null),C=u(!1),j=u("Chi tiết mã giảm giá"),x=u(null),L=u([{label:"Giảm theo phần trăm",value:"percentage"},{label:"Giảm theo số tiền",value:"fixed_amount"}]),N=u([{label:"Sắp diễn ra",value:"upcoming"},{label:"Đang diễn ra",value:"active"},{label:"Dừng chạy",value:"stopped"},{label:"Đã kết thúc",value:"ended"}]),z=[{title:"Chương trình khuyến mại",key:"name",fixed:"left",width:220,ellipsis:!0},{title:"Mã giảm giá",key:"category_id",ellipsis:!0},{title:"Loại giảm giá",key:"type",ellipsis:!0},{title:"Thời gia kết thúc",key:"created_at",render(e){return ee(e.created_at).format("DD/MM/YYYY")}},{title:"Giá trị",key:"value",ellipsis:!0},{title:"Trạng thái",key:"status",render(e){return m(te,{type:(e==null?void 0:e.status)==="active"?"success":(e==null?void 0:e.status)==="ended"?"error":(e==null?void 0:e.status)==="upcoming"?"info":(e==null?void 0:e.status)==="stopped"?"warning":"",size:"small"},{default:()=>(e==null?void 0:e.status)==="upcoming"?"Sắp diễn ra":(e==null?void 0:e.status)==="active"?"Đang diễn ra":(e==null?void 0:e.status)==="stopped"?"Dừng chạy":(e==null?void 0:e.status)==="ended"?"Đã kết thúc":""})}},{title:"Hành động",key:"actions",render(e){return m("div",{class:"flex gap-2"},[m(d,{size:"small",onClick:()=>V(e.id)},{default:()=>"Xem"}),m(d,{size:"small",type:"primary",onClick:()=>R(e.id)},{default:()=>"Sửa"}),m(d,{size:"small",type:"error",onClick:()=>X(e.id)},{default:()=>"Xóa"})])}}];function U(e,t){let i=0;return function(...l){const o=Date.now();if(o-i>=t)return i=o,e.apply(this,l)}}async function b(){var e,t,i,l,o,g,f,h;try{r.value=!0;const c={page:1,length:10};(e=a.value)!=null&&e.search&&(c.search=(t=a.value)==null?void 0:t.search),(i=a.value)!=null&&i.type&&(c.type=(l=a.value)==null?void 0:l.type),(o=a.value)!=null&&o.status&&(c.status=(g=a.value)==null?void 0:g.status);const v=await T.getCoupons(c);v.data.success&&(M.value=((h=(f=v.data)==null?void 0:f.data)==null?void 0:h.coupons)||[],r.value=!1)}catch{$message.error("Không thể tải danh sách mã giảm giá")}finally{r.value=!1}}const _=U(b,500);async function V(e){var t,i;C.value=!0,await ae(),(t=x.value)!=null&&t.focus&&x.value.focus();try{const l=await T.getCouponById(e);B.value=((i=l.data)==null?void 0:i.data)||null}catch{$message.error("Không thể tải chi tiết mã giảm giá")}}function X(e){$dialog.warning({title:"Xác nhận xóa",content:"Bạn có chắc chắn muốn xóa mã giảm giá này?",positiveText:"Xóa",negativeText:"Hủy",onPositiveClick:async()=>{try{await T.deleteCoupon(e),$message.success("Đã xóa mã giảm giá thành công"),b()}catch(t){console.error("Lỗi khi xóa mã giảm giá:",t),$message.error("Không thể xóa mã giảm giá")}}})}function Y(){a.value.search=null,a.value.category_id=null,_()}function K(){var e;(e=a.value)!=null&&e.search||_()}function G(){_()}function Q(){$.push("/coupon/add")}function R(e){$.push(`/coupon/edit/${e}`)}return H(()=>{b()}),(e,t)=>{const i=Z,l=W,o=F,g=w,f=J,h=E,c=A,v=S;return O(),I(v,null,{action:s(()=>[y("div",se,[n(k(d),{type:"info",onClick:Y},{default:s(()=>t[4]||(t[4]=[y("i",{class:"i-material-symbols:refresh mr-4 text-18"},null,-1),D(" Tải lại danh sách ")])),_:1,__:[4]}),n(k(d),{type:"primary",onClick:Q},{default:s(()=>t[5]||(t[5]=[y("i",{class:"i-material-symbols:add mr-4 text-18"},null,-1),D(" Thêm mã giảm giá ")])),_:1,__:[5]})])]),default:s(()=>[n(c,{title:"Quản lý mã giảm giá"},{default:s(()=>[n(h,{vertical:""},{default:s(()=>[y("div",ie,[n(l,{label:"Tìm kiếm mã giảm giá",class:"w-[40%]"},{default:s(()=>[n(i,{class:"w-full",clearable:"",placeholder:"Nhập tìm kiếm ...",value:a.value.search,"onUpdate:value":t[0]||(t[0]=p=>a.value.search=p),onKeyup:q(k(_),["enter"])},null,8,["value","onKeyup"])]),_:1}),n(l,{label:"Loại giảm giá",class:"w-[30%]"},{default:s(()=>[n(o,{class:"w-full",value:a.value.type,"onUpdate:value":[t[1]||(t[1]=p=>a.value.type=p),K],options:L.value,filterable:"",placeholder:"Tất cả loại giảm giá",clearable:""},null,8,["value","options"])]),_:1}),n(l,{label:"Trạng thái",class:"w-[30%]"},{default:s(()=>[n(o,{class:"w-full",value:a.value.status,"onUpdate:value":[t[2]||(t[2]=p=>a.value.status=p),K],options:N.value,filterable:"",placeholder:"Tất cả trạng thái",clearable:""},null,8,["value","options"])]),_:1}),n(k(d),{type:"primary",onClick:G},{default:s(()=>t[6]||(t[6]=[D("Tìm kiếm")])),_:1,__:[6]})]),n(f,{show:r.value},{default:s(()=>[n(g,{columns:z,data:M.value,bordered:!0,striped:!0,loading:r.value},null,8,["data","loading"])]),_:1},8,["show"])]),_:1})]),_:1}),n(ne,{ref_key:"detailModalRef",ref:x,show:C.value,"onUpdate:show":t[3]||(t[3]=p=>C.value=p),data:B.value,title:j.value},null,8,["show","data","title"])]),_:1})}}}),ge=le(ue,[["__scopeId","data-v-492fe2b4"]]);export{ge as default};
