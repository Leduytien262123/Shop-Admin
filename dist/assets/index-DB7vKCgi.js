import{_ as U}from"./CommonPage-r69Mp4tc.js";import{c as r,af as V,d as O,o as Q,e as o,Z as g,u as S,j as s,ah as A,W as E,l as v,aj as W,a8 as Z,a9 as q,g as y,at as F,E as d,h as C,ak as G,al as J,p,am as ee,an as te,O as ae}from"./index-DYcU_f0W.js";import{_ as ne}from"./ModalDetail-DGX9te_j.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TheFooter-BtZThfEk.js";import"./AppCard-kEEXouea.js";const le={class:"flex justìy-end gap-12"},oe={class:"flex gap-12 mb-8 items-end"},re=Object.assign({name:"ProductManagement"},{__name:"index",setup(ie){const b=S(),P=r([]),i=r(!1),l=r({search:null,category_id:null}),$=r(null),k=r(!1),D=r("Chi tiết sản phẩm"),x=r(null),w=r([]),B=[{title:"STT",key:"stt",ellipsis:!0,width:60,fixed:"left",render(t,e){return e+1}},{title:"Tên",key:"name",fixed:"left",ellipsis:!0},{title:"Danh mục",key:"category_id",ellipsis:!0,render(t){const e=w.value.find(a=>a.value===t.category_id);return e?e.label:""}},{title:"Trạng thái",key:"is_active",render(t){return p(ee,{type:t.is_active?"success":"",size:"small"},{default:()=>t.is_active?"Hoạt động":"Dừng hoạt động"})}},{title:"Ngày tạo",key:"created_at",render(t){return te(t.created_at).format("DD/MM/YYYY")}},{title:"Hành động",key:"actions",render(t){return p("div",{class:"flex gap-2"},[p(d,{size:"small",onClick:()=>N(t.id)},{default:()=>"Xem"}),p(d,{size:"small",type:"primary",onClick:()=>I(t.id)},{default:()=>"Sửa"}),p(d,{size:"small",type:"error",onClick:()=>j(t.id)},{default:()=>"Xóa"})])}}];function K(t,e){let a=0;return function(...n){const c=Date.now();if(c-a>=e)return a=c,t.apply(this,n)}}async function T(){var t,e,a,n,c,h;try{i.value=!0;const u={page:1,length:10};(t=l.value)!=null&&t.search&&(u.search=(e=l.value)==null?void 0:e.search),(a=l.value)!=null&&a.category_id&&(u.category_id=(n=l.value)==null?void 0:n.category_id);const f=await g.getProducts(u);f.data.success&&(P.value=((h=(c=f.data)==null?void 0:c.data)==null?void 0:h.products)||[],i.value=!1)}catch{$message.error("Không thể tải danh sách sản phẩm")}finally{i.value=!1}}const m=K(T,500);async function M(){var t;try{i.value=!0;const e={page:1,length:100},a=await g.getCategories(e);w.value=((t=a.data)==null?void 0:t.data.map(n=>({label:n.name,value:n.id})))||[]}catch{$message.error("Không thể tải danh sách danh mục")}finally{i.value=!1}}async function N(t){var e,a;k.value=!0,await ae(),(e=x.value)!=null&&e.focus&&x.value.focus();try{const n=await g.getProductById(t);$.value=((a=n.data)==null?void 0:a.data)||null}catch{$message.error("Không thể tải chi tiết sản phẩm")}}function j(t){$dialog.warning({title:"Xác nhận xóa",content:"Bạn có chắc chắn muốn xóa sản phẩm này?",positiveText:"Xóa",negativeText:"Hủy",onPositiveClick:async()=>{try{await g.deleteProduct(t),$message.success("Đã xóa sản phẩm thành công"),T()}catch(e){console.error("Lỗi khi xóa sản phẩm:",e),$message.error("Không thể xóa sản phẩm")}}})}function z(){l.value.search=null,l.value.category_id=null,m()}function X(){var t;(t=l.value)!=null&&t.search||m()}function Y(){m()}function H(){b.push("/product/add")}function I(t){b.push(`/product/edit/${t}`)}return V(()=>{T(),M()}),(t,e)=>{const a=Z,n=W,c=F,h=J,u=G,f=E,L=A,R=U;return Q(),O(R,null,{action:o(()=>[v("div",le,[s(y(d),{type:"info",onClick:z},{default:o(()=>e[3]||(e[3]=[v("i",{class:"i-material-symbols:refresh mr-4 text-18"},null,-1),C(" Tải lại danh sách ")])),_:1,__:[3]}),s(y(d),{type:"primary",onClick:H},{default:o(()=>e[4]||(e[4]=[v("i",{class:"i-material-symbols:add mr-4 text-18"},null,-1),C(" Thêm sản phẩm ")])),_:1,__:[4]})])]),default:o(()=>[s(L,{title:"Quản lý sản phẩm"},{default:o(()=>[s(f,{vertical:""},{default:o(()=>[v("div",oe,[s(n,{label:"Tìm kiếm sản phẩm",class:"w-[60%]"},{default:o(()=>[s(a,{class:"w-full",clearable:"",placeholder:"Nhập tìm kiếm ...",value:l.value.search,"onUpdate:value":e[0]||(e[0]=_=>l.value.search=_),onKeyup:q(y(m),["enter"])},null,8,["value","onKeyup"])]),_:1}),s(n,{label:"Tìm kiếm danh mục",class:"w-[40%]"},{default:o(()=>[s(c,{class:"w-full",value:l.value.category_id,"onUpdate:value":[e[1]||(e[1]=_=>l.value.category_id=_),X],options:w.value,filterable:"",placeholder:"Tất cả danh mục",clearable:""},null,8,["value","options"])]),_:1}),s(y(d),{type:"primary",onClick:Y},{default:o(()=>e[5]||(e[5]=[C("Tìm kiếm")])),_:1,__:[5]})]),s(u,{show:i.value},{default:o(()=>[s(h,{columns:B,data:P.value,bordered:!0,striped:!0,loading:i.value},null,8,["data","loading"])]),_:1},8,["show"])]),_:1})]),_:1}),s(ne,{ref_key:"detailModalRef",ref:x,show:k.value,"onUpdate:show":e[2]||(e[2]=_=>k.value=_),data:$.value,title:D.value},null,8,["show","data","title"])]),_:1})}}}),he=se(re,[["__scopeId","data-v-058a1630"]]);export{he as default};
