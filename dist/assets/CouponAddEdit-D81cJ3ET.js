import{_ as D}from"./CommonPage-r69Mp4tc.js";import{u as G,c as m,J as K,w as L,af as M,d as R,o as z,e as n,j as t,ao as A,au as F,av as H,aj as I,a8 as J,at as O,aw as Q,l as N,W,E as Z,h as f,t as X,ah as Y,Z as _}from"./index-DYcU_f0W.js";const ee={class:"flex items-center justify-center"},ne=Object.assign({name:"CouponAddEdit"},{__name:"CouponAddEdit",props:{id:{type:[String,Number],default:null}},setup(k){const p=k,C=G(),l=m({name:"",slug:"",sku:"",category_id:null,description:"",price:null,discount_price:null}),c=K(()=>!!p.id),h=m([]),d=m(!1),V={name:[{required:!0,message:"Vui lòng nhập tên mã giảm giá",trigger:["blur","input"]}],slug:[{required:!0,message:"Vui lòng nhập đường dẫn",trigger:["blur","input"]}],sku:[{required:!0,message:"Vui lòng nhập SKU",trigger:["blur","input"]}],category_id:[{required:!0,message:"Vui lòng chọn danh mục",trigger:["blur","change"]}],price:[{required:!0,trigger:["blur","input"],validator(e,a){return a?!0:new Error("Vui lòng nhập giá mã giảm giá")}}],discount_price:[{required:!1,trigger:["blur","input"],validator(e,a){var r,o;if(a!=null&&a!==""){if(Number(a)>Number((r=l.value)==null?void 0:r.price))return new Error("Giá sale không được lớn hơn giá bán");if(Number(a)===Number((o=l.value)==null?void 0:o.price))return new Error("Giá sale không được bằng giá bán")}return!0}}]};function S(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-")}L(()=>l.value.name,e=>{e&&(l.value.slug=S(e))});const v=m(null);async function U(){var e;try{d.value=!0;const a={page:1,length:10},r=await _.getCategories(a);h.value=((e=r.data)==null?void 0:e.data.map(o=>({label:o.name,value:o.id})))||[]}catch{$message.error("Không thể tải danh sách danh mục")}finally{d.value=!1}}async function $(){if(p.id)try{d.value=!0;const e=await _.getProductById(p.id);e.data.success&&(l.value={name:e.data.data.name||"",description:e.data.data.description||"",slug:e.data.data.slug||"",is_active:e.data.data.is_active,category_id:e.data.data.category_id||null,sku:e.data.data.sku||"",price:e.data.data.price||null,discount_price:e.data.data.discount_price||null,show_menu:e.data.data.show_menu,show_home:e.data.data.show_home,show_footer:e.data.data.show_footer,meta_title:e.data.data.meta_title||"",meta_keywords:e.data.data.meta_keywords||"",meta_description:e.data.data.meta_description||"",meta_image:e.data.data.meta_image||[]})}catch(e){$message.error("Không thể tải thông tin danh mục"),console.error("Load category error:",e)}finally{d.value=!1}}M(()=>{U(),c.value&&$()});function g(){C.push("/product")}async function x(){var e;try{await((e=v.value)==null?void 0:e.validate()),d.value=!0,c.value?(await _.updateProduct(p.id,l.value),$message.success("Cập nhật mã giảm giá thành công!")):(await _.createProduct(l.value),$message.success("Thêm mã giảm giá thành công!")),g()}catch(a){if(a!=null&&a.errors)return;const r=c.value?"Cập nhật danh mục thất bại":"Thêm danh mục thất bại";$message.error(r),console.error("Save category error:",a)}finally{d.value=!1}}const y=e=>{const a=e.replace(/[^\d.]/g,"").trim();return/^\d+(\.(\d+)?)?$/.test(a)?Number(a):a===""?null:Number.NaN},b=e=>e==null||isNaN(e)?"":e.toLocaleString("vi-VN",{style:"currency",currency:"VND"});return(e,a)=>{const r=Z,o=J,s=I,i=H,B=O,w=Q,E=F,q=A,P=W,T=Y,j=D;return z(),R(j,null,{action:n(()=>[t(r,{onClick:g},{default:n(()=>a[7]||(a[7]=[N("i",{class:"i-material-symbols:arrow-back mr-4 text-18"},null,-1),f(" Quay lại ")])),_:1,__:[7]})]),default:n(()=>[t(T,{title:c.value?"Sửa mã giảm giá":"Thêm mã giảm giá"},{action:n(()=>[N("div",ee,[t(P,null,{default:n(()=>[t(r,{onClick:g},{default:n(()=>a[8]||(a[8]=[f("Hủy")])),_:1,__:[8]}),t(r,{type:"primary",onClick:x},{default:n(()=>[f(X(c.value?"Cập nhật":"Lưu"),1)]),_:1})]),_:1})])]),default:n(()=>[t(q,{model:l.value,rules:V,ref_key:"formRef",ref:v},{default:n(()=>[t(E,{cols:"3","x-gap":"24","y-gap":"16"},{default:n(()=>[t(i,{span:"3"},{default:n(()=>[t(s,{label:"Tên mã giảm giá",path:"name"},{default:n(()=>[t(o,{value:l.value.name,"onUpdate:value":a[0]||(a[0]=u=>l.value.name=u),placeholder:"Nhập tên mã giảm giá"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:"2"},{default:n(()=>[t(s,{label:"Đường dẫn",path:"slug"},{default:n(()=>[t(o,{value:l.value.slug,"onUpdate:value":a[1]||(a[1]=u=>l.value.slug=u),placeholder:"Nhập đường dẫn"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:"1"},{default:n(()=>[t(s,{label:"Danh mục",path:"category_id"},{default:n(()=>[t(B,{value:l.value.category_id,"onUpdate:value":a[2]||(a[2]=u=>l.value.category_id=u),options:h.value,filterable:"",placeholder:"Chọn danh mục",clearable:""},null,8,["value","options"])]),_:1})]),_:1}),t(i,{span:"1"},{default:n(()=>[t(s,{label:"SKU",path:"sku"},{default:n(()=>[t(o,{value:l.value.sku,"onUpdate:value":a[3]||(a[3]=u=>l.value.sku=u),placeholder:"Nhập sku"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:"1"},{default:n(()=>[t(s,{label:"Giá",path:"price"},{default:n(()=>[t(w,{value:l.value.price,"onUpdate:value":a[4]||(a[4]=u=>l.value.price=u),"show-button":!1,parse:y,format:b,placeholder:"Nhập giá mã giảm giá",class:"w-full"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:"1"},{default:n(()=>[t(s,{label:"Giá sale",path:"discount_price"},{default:n(()=>[t(w,{value:l.value.discount_price,"onUpdate:value":a[5]||(a[5]=u=>l.value.discount_price=u),"show-button":!1,parse:y,format:b,placeholder:"Nhập giá khuyến mãi",class:"w-full"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:"3"},{default:n(()=>[t(s,{label:"Mô tả",path:"description"},{default:n(()=>[t(o,{value:l.value.description,"onUpdate:value":a[6]||(a[6]=u=>l.value.description=u),type:"textarea",placeholder:"Nhập mô tả mã giảm giá"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})}}});export{ne as _};
