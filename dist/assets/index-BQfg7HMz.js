import{_ as R}from"./TheFooter-BtZThfEk.js";import{a5 as h,S as U,c as x,a6 as k,a7 as q,f as V,o as T,l as a,j as l,h as b,t as D,g as n,e as c,a8 as K,a9 as C,y as M,aa as E,E as A,a as F,u as P}from"./index-DYcU_f0W.js";import{t as j}from"./common-BF9XxHS1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G="/assets/login_banner-BD2eW0TC.webp",J="/assets/logo-Bw3FJMyu.png",W={toggleRole:g=>h.post("/auth/role/toggle",g),login:g=>h.post("/api/auth/login",g,{needToken:!1}),getCaptcha:()=>h.get("/api/auth/captcha",{needToken:!1,responseType:"blob"}),getUser:()=>h.get("/api/user/profile")},z={class:"wh-full flex-col bg-[url(@/assets/images/login_bg.webp)] bg-cover"},H={class:"m-auto max-w-700 min-w-345 f-c-c rounded-8 auto-bg bg-opacity-20 bg-cover p-12 card-shadow"},O={class:"w-320 flex-col px-20 py-32"},Q={class:"f-c-c text-24 text-#6a6a6a font-normal"},X={class:"mt-20 flex items-center"},Y=["src"],Z={class:"mt-20 flex items-center"},oe={__name:"index",setup(g){const B=U(),$=P(),S=F(),I="Vue Naive Admin",o=x({username:"",password:""}),f=x(""),p=j(()=>{const i=Date.now(),e=Math.random().toString(36).substring(2,15);f.value=`https://mock.apipark.cn/m1/3776410-0-default/auth/captcha?_t=${i}&_r=${e}`},500),v=k.get("loginInfo");v&&(o.value.username=v.username||"",o.value.password=v.password||""),p();function L(){o.value.username="owner",o.value.password="owner123",m(!0)}const w=q("isRemember",!0),_=x(!1);async function m(i){var u,d;const{username:e,password:t,captcha:y}=o.value;if(!e||!t)return $message.warning("Vui lòng nhập tên người dùng và mật khẩu");if(!i&&!y)return $message.warning("Vui lòng nhập mã xác thực");try{_.value=!0,$message.loading("Đang xác thực, vui lòng đợi...",{key:"login"});const s=await W.login({username:e,password:t.toString()});let r=null;if((u=s==null?void 0:s.data)!=null&&u.success&&(r=s==null?void 0:s.data),r&&r.success)w.value?k.set("loginInfo",{username:e,password:t}):k.remove("loginInfo"),N(r);else throw new Error("Không thể xử lý response từ server. Vui lòng kiểm tra console để biết chi tiết.")}catch(s){p(),o.value.captcha="",$message.destroy("login");let r="Đăng nhập thất bại";s.response?r=((d=s.response.data)==null?void 0:d.message)||s.response.statusText||r:s.message&&(r=s.message),$message.error(r)}_.value=!1}async function N(i={}){if(!B.setToken(i)){$message.error("Lỗi khi lưu token đăng nhập");return}$message.loading("Đang đăng nhập...",{key:"login"});try{$message.success("Đăng nhập thành công",{key:"login"});const t=S.query.redirect||"/";delete S.query.redirect,t&&t!=="/login"?$.push(t):$.push("/")}catch(t){console.error(t),$message.destroy("login")}}return(i,e)=>{const t=K,y=E,u=A,d=R;return T(),V("div",z,[a("div",H,[e[14]||(e[14]=a("div",{class:"hidden w-380 px-20 py-35 md:block"},[a("img",{src:G,class:"w-full",alt:"login_banner"})],-1)),a("div",O,[a("h2",Q,[e[8]||(e[8]=a("img",{src:J,class:"mr-12 h-50"},null,-1)),b(" "+D(n(I)),1)]),l(t,{value:n(o).username,"onUpdate:value":e[0]||(e[0]=s=>n(o).username=s),autofocus:"",class:"mt-32 h-40 items-center",placeholder:"Vui lòng nhập tên người dùng",maxlength:20},{prefix:c(()=>e[9]||(e[9]=[a("i",{class:"i-fe:user mr-12 opacity-20"},null,-1)])),_:1},8,["value"]),l(t,{value:n(o).password,"onUpdate:value":e[1]||(e[1]=s=>n(o).password=s),class:"mt-20 h-40 items-center",type:"password","show-password-on":"mousedown",placeholder:"Vui lòng nhập mật khẩu",maxlength:20,onKeydown:e[2]||(e[2]=C(s=>m(),["enter"]))},{prefix:c(()=>e[10]||(e[10]=[a("i",{class:"i-fe:lock mr-12 opacity-20"},null,-1)])),_:1},8,["value"]),a("div",X,[l(t,{value:n(o).captcha,"onUpdate:value":e[3]||(e[3]=s=>n(o).captcha=s),class:"h-40 items-center",placeholder:"Vui lòng nhập mã xác thực",maxlength:4,onKeydown:e[4]||(e[4]=C(s=>m(),["enter"]))},{prefix:c(()=>e[11]||(e[11]=[a("i",{class:"i-fe:key mr-12 opacity-20"},null,-1)])),_:1},8,["value"]),n(f)?(T(),V("img",{key:0,src:n(f),alt:"Mã xác thực",height:"40",class:"ml-12 w-80 cursor-pointer",onClick:e[5]||(e[5]=(...s)=>n(p)&&n(p)(...s))},null,8,Y)):M("",!0)]),l(y,{class:"mt-20",checked:n(w),label:"Ghi nhớ đăng nhập","on-update:checked":s=>w.value=s},null,8,["checked","on-update:checked"]),a("div",Z,[l(u,{class:"h-40 flex-1 rounded-5 text-16",type:"primary",ghost:"",onClick:e[6]||(e[6]=s=>L())},{default:c(()=>e[12]||(e[12]=[b(" Trải nghiệm nhanh ")])),_:1,__:[12]}),l(u,{class:"ml-32 h-40 flex-1 rounded-5 text-16",type:"primary",loading:n(_),onClick:e[7]||(e[7]=s=>m())},{default:c(()=>e[13]||(e[13]=[b(" Đăng nhập ")])),_:1,__:[13]},8,["loading"])])])]),l(d,{class:"py-12"})])}}};export{oe as default};
