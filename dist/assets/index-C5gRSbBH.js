import{_ as F}from"./CommonPage-r69Mp4tc.js";import{c as i,af as G,d as J,o as ee,e as n,an as N,Z as S,u as te,j as a,ah as ae,W as le,l as h,au as ne,av as oe,aj as se,a8 as ue,a9 as z,g as v,at as re,ax as ie,E as p,h as $,ak as de,al as ce,p as _,O as pe}from"./index-DYcU_f0W.js";import{_ as _e}from"./ModalDetail-DGX9te_j.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TheFooter-BtZThfEk.js";import"./AppCard-kEEXouea.js";const fe={class:"flex justìy-end gap-12"},me={class:"flex mb-8"},ge={class:"flex gap-12 justify-end"},he=Object.assign({name:"OrderManagement"},{__name:"index",setup(ye){const U=te(),B=i([]),f=i(!1),e=i({order_code:null,customer:null,type_order:null,status:null,payment_status:null,creator:null,range:null}),D=i(null),w=i(!1),A=i("Chi tiết đơn hàng"),K=i(null),H=i([{label:"Đơn web",value:"web"},{label:"Đơn khách lẻ",value:"retail"}]),I=i([{label:"Chờ xử lý",value:"pending"},{label:"Đang xử lý",value:"processing"},{label:"Hoàn thành",value:"completed"},{label:"Đã hủy",value:"canceled"},{label:"Trả hàng",value:"refunded"}]),Y=i([{label:"Chưa thanh toán",value:"unpaid"},{label:"Đã thanh toán",value:"paid"},{label:"Hoàn tiền",value:"refunded"}]),P=i([{label:"Admin",value:"admin"},{label:"Nhân viên 1",value:"staff1"},{label:"Nhân viên 2",value:"staff2"}]),Q=[{title:"STT",key:"stt",ellipsis:!0,width:60,fixed:"left",render(l,t){return t+1}},{title:"Mã đơn hàng",key:"name",ellipsis:!0},{title:"Khách hàng",key:"customer_name",ellipsis:!0,render(l){return _("div",{},[_("div",{},(l==null?void 0:l.customer_name)||""),_("div",{style:"color: #888; font-size: 12px;"},(l==null?void 0:l.customer_phone)||"")])}},{title:"Loại đơn hàng",key:"type_order",ellipsis:!0},{title:"Trạng thái",key:"status",ellipsis:!0},{title:"Thanh toán",key:"payment_status",ellipsis:!0},{title:"Ngày tạo",key:"created_at",render(l){return N(l.created_at).format("DD/MM/YYYY")}},{title:"Người tạo đơn",key:"creator_name",ellipsis:!0},{title:"Hành động",key:"actions",render(l){return _("div",{class:"flex gap-2"},[_(p,{size:"small",onClick:()=>V(l.id)},{default:()=>"Xem"}),_(p,{size:"small",type:"primary",onClick:()=>q(l.id)},{default:()=>"Sửa"}),_(p,{size:"small",type:"error",onClick:()=>E(l.id)},{default:()=>"Xóa"})])}}];function R(l,t){let r=0;return function(...s){const u=Date.now();if(u-r>=t)return r=u,l.apply(this,s)}}async function M(){var l,t,r,s,u,c,y,b,x,k,T,O,C,o,L;try{f.value=!0;const d={page:1,length:10};(l=e.value)!=null&&l.order_code&&(d.order_code=(t=e.value)==null?void 0:t.order_code),(r=e.value)!=null&&r.customer&&(d.customer=(s=e.value)==null?void 0:s.customer),(u=e.value)!=null&&u.type_order&&(d.type_order=(c=e.value)==null?void 0:c.type_order),(y=e.value)!=null&&y.status&&(d.status=(b=e.value)==null?void 0:b.status),(x=e.value)!=null&&x.payment_status&&(d.payment_status=(k=e.value)==null?void 0:k.payment_status),(T=e.value)!=null&&T.creator&&(d.creator=(O=e.value)==null?void 0:O.creator),(C=e.value)!=null&&C.range&&Array.isArray(e.value.range)&&e.value.range.length===2&&(d.start_time=N(e.value.range[0]).startOf("day").toISOString(),d.end_time=N(e.value.range[1]).endOf("day").toISOString());const X=await S.getOrders(d);X.data.success&&(B.value=((L=(o=X.data)==null?void 0:o.data)==null?void 0:L.orders)||[],f.value=!1)}catch{$message.error("Không thể tải danh sách đơn hàng")}finally{f.value=!1}}const m=R(M,500);async function V(l){var t,r;w.value=!0,await pe(),(t=K.value)!=null&&t.focus&&K.value.focus();try{const s=await S.getOrderById(l);D.value=((r=s.data)==null?void 0:r.data)||null}catch{$message.error("Không thể tải chi tiết đơn hàng")}}function E(l){$dialog.warning({title:"Xác nhận xóa",content:"Bạn có chắc chắn muốn xóa đơn hàng này?",positiveText:"Xóa",negativeText:"Hủy",onPositiveClick:async()=>{try{await S.deleteOrder(l),$message.success("Đã xóa đơn hàng thành công"),M()}catch(t){console.error("Lỗi khi xóa đơn hàng:",t),$message.error("Không thể xóa đơn hàng")}}})}function W(){e.value.order_code=null,e.value.customer=null,e.value.type_order=null,e.value.status=null,e.value.payment_status=null,e.value.creator=null,e.value.range=null,m()}function g(){var l;!((l=e.value)!=null&&l.customer)&&!e.value.order_code&&m()}function j(){m()}function Z(){U.push("/order/add")}function q(l){U.push(`/order/edit/${l}`)}return G(()=>{M()}),(l,t)=>{const r=ue,s=se,u=oe,c=re,y=ie,b=ne,x=ce,k=de,T=le,O=ae,C=F;return ee(),J(C,null,{action:n(()=>[h("div",fe,[a(v(p),{type:"info",onClick:W},{default:n(()=>t[8]||(t[8]=[h("i",{class:"i-material-symbols:refresh mr-4 text-18"},null,-1),$(" Tải lại danh sách ")])),_:1,__:[8]}),a(v(p),{type:"primary",onClick:Z},{default:n(()=>t[9]||(t[9]=[h("i",{class:"i-material-symbols:add mr-4 text-18"},null,-1),$(" Thêm đơn hàng ")])),_:1,__:[9]})])]),default:n(()=>[a(O,{title:"Quản lý đơn hàng"},{default:n(()=>[a(T,{vertical:""},{default:n(()=>[h("div",me,[a(b,{cols:"3","x-gap":"12","y-gap":"12"},{default:n(()=>[a(u,{span:"1"},{default:n(()=>[a(s,{label:"Mã đơn hàng"},{default:n(()=>[a(r,{clearable:"",placeholder:"Mã đơn hàng ...",value:e.value.order_code,"onUpdate:value":t[0]||(t[0]=o=>e.value.order_code=o),onKeyup:z(v(m),["enter"])},null,8,["value","onKeyup"])]),_:1})]),_:1}),a(u,{span:"1"},{default:n(()=>[a(s,{label:"Khách hàng"},{default:n(()=>[a(r,{clearable:"",placeholder:"Tên khách hàng or Số điện thoại ...",value:e.value.customer,"onUpdate:value":t[1]||(t[1]=o=>e.value.customer=o),onKeyup:z(v(m),["enter"])},null,8,["value","onKeyup"])]),_:1})]),_:1}),a(u,{span:"1"},{default:n(()=>[a(s,{label:"Loại đơn hàng"},{default:n(()=>[a(c,{value:e.value.type_order,"onUpdate:value":[t[2]||(t[2]=o=>e.value.type_order=o),g],options:H.value,filterable:"",placeholder:"Tất cả loại đơn",clearable:""},null,8,["value","options"])]),_:1})]),_:1}),a(u,{span:"1"},{default:n(()=>[a(s,{label:"Trạng thái xử lý"},{default:n(()=>[a(c,{value:e.value.status,"onUpdate:value":[t[3]||(t[3]=o=>e.value.status=o),g],filterable:"",placeholder:"Tất cả trạng thái",clearable:"",options:I.value},null,8,["value","options"])]),_:1})]),_:1}),a(u,{span:"1"},{default:n(()=>[a(s,{label:"Trạng thái thanh toán"},{default:n(()=>[a(c,{value:e.value.payment_status,"onUpdate:value":[t[4]||(t[4]=o=>e.value.payment_status=o),g],filterable:"",placeholder:"Tất cả thanh toán",clearable:"",options:Y.value},null,8,["value","options"])]),_:1})]),_:1}),a(u,{span:"1"},{default:n(()=>[a(s,{label:"Người tạo đơn"},{default:n(()=>[a(c,{value:e.value.creator,"onUpdate:value":[t[5]||(t[5]=o=>e.value.creator=o),g],filterable:"",placeholder:"Tất cả người tạo",clearable:"",options:P.value},null,8,["value","options"])]),_:1})]),_:1}),a(u,{span:"1"},{default:n(()=>[a(s,{label:"Ngày tạo"},{default:n(()=>[a(y,{value:e.value.range,"onUpdate:value":[t[6]||(t[6]=o=>e.value.range=o),g],type:"daterange",clearable:"",class:"w-full"},null,8,["value"])]),_:1})]),_:1}),a(u,{span:"3"},{default:n(()=>[h("div",ge,[a(v(p),{type:"success",onClick:j},{default:n(()=>t[10]||(t[10]=[$("Xuất file")])),_:1,__:[10]}),a(v(p),{type:"primary",onClick:j},{default:n(()=>t[11]||(t[11]=[$("Tìm kiếm")])),_:1,__:[11]})])]),_:1})]),_:1})]),a(k,{show:f.value},{default:n(()=>[a(x,{columns:Q,data:B.value,bordered:!0,striped:!0,loading:f.value},null,8,["data","loading"])]),_:1},8,["show"])]),_:1})]),_:1}),a(_e,{ref_key:"detailModalRef",ref:K,show:w.value,"onUpdate:show":t[7]||(t[7]=o=>w.value=o),data:D.value,title:A.value},null,8,["show","data","title"])]),_:1})}}}),$e=ve(he,[["__scopeId","data-v-cdcfc947"]]);export{$e as default};
