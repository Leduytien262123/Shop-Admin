import{_ as M}from"./CommonPage-r69Mp4tc.js";import{c as f,af as V,d as A,o as E,e as s,u as P,j as t,g as l,p as d,G as B,a8 as D,at as z,Y as F,ao as L,aj as j,aC as K,ap as h,h as _,E as c,l as G}from"./index-DYcU_f0W.js";import{u as O}from"./useCrud-nALScKQu.js";import{_ as Q}from"./index-DzJzXdOC.js";import{_ as g}from"./QueryItem-TlJu4VT3.js";import{a as u}from"./api-qSY_K89_.js";import"./TheFooter-BtZThfEk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppCard-kEEXouea.js";const te=Object.assign({name:"RoleMgt"},{__name:"index",setup(X){const y=P(),m=f(null),r=f({});V(()=>{var a;(a=m.value)==null||a.handleSearch()});const{modalRef:v,modalFormRef:k,modalAction:x,modalForm:o,handleAdd:T,handleDelete:U,handleEdit:R}=O({name:"Vai trò",doCreate:u.create,doDelete:u.delete,doUpdate:u.update,initForm:{enable:!0},refresh:(a,e)=>{var i;return(i=m.value)==null?void 0:i.handleSearch(e)}}),C=[{title:"Tên vai trò",key:"name"},{title:"Mã vai trò",key:"code"},{title:"Trạng thái",key:"enable",render:a=>d(h,{size:"small",rubberBand:!1,value:a.enable,loading:!!a.enableLoading,disabled:a.code==="SUPER_ADMIN",onUpdateValue:()=>N(a)},{checked:()=>"Kích hoạt",unchecked:()=>"Tắt"})},{title:"Thao tác",key:"actions",width:320,align:"right",fixed:"right",render(a){return[d(c,{size:"small",type:"primary",secondary:!0,onClick:()=>y.push({path:`/pms/role/user/${a.id}`,query:{roleName:a.name}})},{default:()=>"Phân quyền người dùng",icon:()=>d("i",{class:"i-fe:user-plus text-14"})}),d(c,{size:"small",type:"primary",style:"margin-left: 12px;",disabled:a.code==="SUPER_ADMIN",onClick:()=>R(a)},{default:()=>"Sửa",icon:()=>d("i",{class:"i-material-symbols:edit-outline text-14"})}),d(c,{size:"small",type:"error",style:"margin-left: 12px;",disabled:a.code==="SUPER_ADMIN",onClick:()=>U(a.id)},{default:()=>"Xóa",icon:()=>d("i",{class:"i-material-symbols:delete-outline text-14"})})]}}];async function N(a){var e;a.enableLoading=!0;try{await u.update({id:a.id,enable:!a.enable}),a.enableLoading=!1,$message.success("Thao tác thành công"),(e=m.value)==null||e.handleSearch()}catch(i){console.error(i),a.enableLoading=!1}}const b=f([]);return u.getAllPermissionTree().then(({data:a=[]})=>b.value=a),(a,e)=>{const i=D,$=z,p=j,q=K,I=L,S=M;return E(),A(S,null,{action:s(()=>[t(l(c),{type:"primary",onClick:e[0]||(e[0]=n=>l(T)())},{default:s(()=>e[7]||(e[7]=[G("i",{class:"i-material-symbols:add mr-4 text-18"},null,-1),_(" Thêm vai trò ")])),_:1,__:[7]})]),default:s(()=>[t(l(Q),{ref_key:"$table",ref:m,"query-items":l(r),"onUpdate:queryItems":e[3]||(e[3]=n=>B(r)?r.value=n:null),"scroll-x":1200,columns:C,"get-data":l(u).read},{default:s(()=>[t(l(g),{label:"Tên vai trò","label-width":80},{default:s(()=>[t(i,{value:l(r).name,"onUpdate:value":e[1]||(e[1]=n=>l(r).name=n),type:"text",placeholder:"Nhập tên vai trò",clearable:""},null,8,["value"])]),_:1}),t(l(g),{label:"Trạng thái","label-width":50},{default:s(()=>[t($,{value:l(r).enable,"onUpdate:value":e[2]||(e[2]=n=>l(r).enable=n),clearable:"",options:[{label:"Kích hoạt",value:1},{label:"Tắt",value:0}]},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),t(l(F),{ref_key:"modalRef",ref:v,width:"520px"},{default:s(()=>[t(I,{ref_key:"modalFormRef",ref:k,"label-placement":"left","label-align":"left","label-width":80,model:l(o)},{default:s(()=>[t(p,{label:"Tên vai trò",path:"name",rule:{required:!0,message:"Vui lòng nhập tên vai trò",trigger:["input","blur"]}},{default:s(()=>[t(i,{value:l(o).name,"onUpdate:value":e[4]||(e[4]=n=>l(o).name=n)},null,8,["value"])]),_:1}),t(p,{label:"Mã vai trò",path:"code",rule:{required:!0,message:"Vui lòng nhập mã vai trò",trigger:["input","blur"]}},{default:s(()=>[t(i,{value:l(o).code,"onUpdate:value":e[5]||(e[5]=n=>l(o).code=n),disabled:l(x)!=="add"},null,8,["value","disabled"])]),_:1}),t(p,{label:"Quyền",path:"permissionIds"},{default:s(()=>[t(q,{"key-field":"id","label-field":"name",selectable:!1,data:l(b),"checked-keys":l(o).permissionIds,"on-update:checked-keys":n=>l(o).permissionIds=n,checkable:"","check-on-click":"","default-expand-all":"",class:"cus-scroll max-h-200 w-full"},null,8,["data","checked-keys","on-update:checked-keys"])]),_:1}),t(p,{label:"Trạng thái",path:"enable"},{default:s(()=>[t(l(h),{value:l(o).enable,"onUpdate:value":e[6]||(e[6]=n=>l(o).enable=n)},{checked:s(()=>e[8]||(e[8]=[_(" Kích hoạt ")])),unchecked:s(()=>e[9]||(e[9]=[_(" Tắt ")])),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},512)]),_:1})}}});export{te as default};
