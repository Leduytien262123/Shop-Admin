import{_ as F}from"./CommonPage-r69Mp4tc.js";import{u as L}from"./useCrud-nALScKQu.js";import{a5 as g,c as x,af as j,d as f,o as h,e as n,az as G,j as i,g as t,p as r,G as K,a8 as M,at as X,Y,y as v,ao as H,aj as J,ap as C,h as y,aA as Q,a0 as W,E as b,l as Z,a4 as ee,am as ae,aB as te}from"./index-DYcU_f0W.js";import{f as le}from"./common-BF9XxHS1.js";import{_ as ne}from"./index-DzJzXdOC.js";import{_ as T}from"./QueryItem-TlJu4VT3.js";import"./TheFooter-BtZThfEk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppCard-kEEXouea.js";const p={create:o=>g.post("/api/admin/users",o),read:(o={})=>g.get("/api/admin/users",{params:o}),update:o=>g.put(`/api/admin/users/${o.id}`,o),delete:o=>g.delete(`/api/admin/users/${o}`),resetPwd:(o,c)=>g.post(`/api/admin/users/${o}/reset-password`,c),getAllRoles:()=>g.get("/api/admin/roles?enable=1")},ge=Object.assign({name:"UserMgt"},{__name:"index",setup(o){const c=x(null),u=x({});j(()=>{var e;(e=c.value)==null||e.handleSearch()});const $=[{label:"Nam",value:1},{label:"Nữ",value:2}],U=x([]);p.getAllRoles().then(({data:e=[]})=>U.value=e);const{modalRef:N,modalFormRef:V,modalForm:s,modalAction:m,handleAdd:S,handleDelete:z,handleOpen:q,handleSave:k}=L({name:"Người dùng",initForm:{enable:!0},doCreate:p.create,doDelete:p.delete,doUpdate:p.update,refresh:()=>{var e;return(e=c.value)==null?void 0:e.handleSearch()}}),A=[{title:"Ảnh đại diện",key:"avatar",width:80,render:({avatar:e})=>r(ee,{size:"medium",src:e})},{title:"Tên người dùng",key:"username",width:150,ellipsis:{tooltip:!0}},{title:"Vai trò",key:"roles",width:200,ellipsis:{tooltip:!0},render:({roles:e})=>e!=null&&e.length?e.map((a,d)=>r(ae,{type:"success",style:d>0?"margin-left: 8px;":""},{default:()=>a.name})):"Chưa có vai trò"},{title:"Giới tính",key:"gender",width:80,render:({gender:e})=>{var a;return((a=$.find(d=>e===d.value))==null?void 0:a.label)??""}},{title:"Email",key:"email",width:150,ellipsis:{tooltip:!0}},{title:"Thời gian tạo",key:"createDate",width:180,render(e){return r("span",le(e.createTime))}},{title:"Trạng thái",key:"enable",width:120,render:e=>r(C,{size:"small",rubberBand:!1,value:e.enable,loading:!!e.enableLoading,onUpdateValue:()=>D(e)},{checked:()=>"Kích hoạt",unchecked:()=>"Tắt"})},{title:"Thao tác",key:"actions",width:420,align:"right",fixed:"right",hideInExcel:!0,render(e){return[te(r(b,{size:"small",type:"primary",secondary:!0},{default:()=>"Dành cho quản trị",icon:()=>r("i",{class:"i-carbon:user-role text-14"})}),"SuperAdmin"),r(b,{size:"small",type:"primary",class:"ml-12px",secondary:!0,onClick:()=>I(e)},{default:()=>"Phân quyền vai trò",icon:()=>r("i",{class:"i-carbon:user-role text-14"})}),r(b,{size:"small",type:"primary",style:"margin-left: 12px;",onClick:()=>q({action:"reset",title:"Đặt lại mật khẩu",row:e,onOk:R})},{default:()=>"Đặt lại mật khẩu",icon:()=>r("i",{class:"i-radix-icons:reset text-14"})}),r(b,{size:"small",type:"error",style:"margin-left: 12px;",onClick:()=>z(e.id)},{default:()=>"Xóa",icon:()=>r("i",{class:"i-material-symbols:delete-outline text-14"})})]}}];async function D(e){var a;e.enableLoading=!0;try{await p.update({id:e.id,enable:!e.enable}),e.enableLoading=!1,$message.success("Thao tác thành công"),(a=c.value)==null||a.handleSearch()}catch(d){console.error(d),e.enableLoading=!1}}function I(e){const a=e.roles.map(d=>d.id);q({action:"setRole",title:"Phân quyền vai trò",row:{id:e.id,username:e.username,roleIds:a},onOk:R})}function R(){if(m.value==="setRole")return k({api:()=>p.update(s.value),cb:()=>$message.success("Phân quyền thành công")});if(m.value==="reset")return k({api:()=>p.resetPwd(s.value.id,s.value),cb:()=>$message.success("Đặt lại mật khẩu thành công")});k()}return(e,a)=>{const d=M,w=X,_=J,P=H,B=Q,O=F,E=G("permission");return h(),f(O,null,{action:n(()=>[W((h(),f(t(b),{type:"primary",onClick:a[0]||(a[0]=l=>t(S)())},{default:n(()=>a[9]||(a[9]=[Z("i",{class:"i-material-symbols:add mr-4 text-18"},null,-1),y(" Tạo người dùng mới ")])),_:1,__:[9]})),[[E,"AddUser"]])]),default:n(()=>[i(t(ne),{ref_key:"$table",ref:c,"query-items":t(u),"onUpdate:queryItems":a[4]||(a[4]=l=>K(u)?u.value=l:null),"scroll-x":1200,columns:A,"get-data":t(p).read},{default:n(()=>[i(t(T),{label:"Tên người dùng","label-width":90},{default:n(()=>[i(d,{value:t(u).username,"onUpdate:value":a[1]||(a[1]=l=>t(u).username=l),type:"text",placeholder:"Nhập tên người dùng",clearable:""},null,8,["value"])]),_:1}),i(t(T),{label:"Giới tính","label-width":50},{default:n(()=>[i(w,{value:t(u).gender,"onUpdate:value":a[2]||(a[2]=l=>t(u).gender=l),clearable:"",options:$},null,8,["value"])]),_:1}),i(t(T),{label:"Trạng thái","label-width":50},{default:n(()=>[i(w,{value:t(u).enable,"onUpdate:value":a[3]||(a[3]=l=>t(u).enable=l),clearable:"",options:[{label:"Kích hoạt",value:1},{label:"Tắt",value:0}]},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),i(t(Y),{ref_key:"modalRef",ref:N,width:"520px"},{default:n(()=>[i(P,{ref_key:"modalFormRef",ref:V,"label-placement":"left","label-align":"left","label-width":80,model:t(s),disabled:t(m)==="view"},{default:n(()=>[i(_,{label:"Tên người dùng",path:"username",rule:{required:!0,message:"Vui lòng nhập tên người dùng",trigger:["input","blur"]}},{default:n(()=>[i(d,{value:t(s).username,"onUpdate:value":a[5]||(a[5]=l=>t(s).username=l),disabled:t(m)!=="add"},null,8,["value","disabled"])]),_:1}),["add","reset"].includes(t(m))?(h(),f(_,{key:0,label:t(m)==="reset"?"Đặt lại mật khẩu":"Mật khẩu ban đầu",path:"password",rule:{required:!0,message:"Vui lòng nhập mật khẩu",trigger:["input","blur"]}},{default:n(()=>[i(d,{value:t(s).password,"onUpdate:value":a[6]||(a[6]=l=>t(s).password=l),type:"password","show-password-on":"mousedown"},null,8,["value"])]),_:1},8,["label"])):v("",!0),["add","setRole"].includes(t(m))?(h(),f(_,{key:1,label:"Vai trò",path:"roleIds"},{default:n(()=>[i(w,{value:t(s).roleIds,"onUpdate:value":a[7]||(a[7]=l=>t(s).roleIds=l),options:t(U),"label-field":"name","value-field":"id",clearable:"",filterable:"",multiple:""},null,8,["value","options"])]),_:1})):v("",!0),t(m)==="add"?(h(),f(_,{key:2,label:"Trạng thái",path:"enable"},{default:n(()=>[i(t(C),{value:t(s).enable,"onUpdate:value":a[8]||(a[8]=l=>t(s).enable=l)},{checked:n(()=>a[10]||(a[10]=[y(" Kích hoạt ")])),unchecked:n(()=>a[11]||(a[11]=[y(" Tắt ")])),_:1},8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","disabled"]),t(m)==="add"?(h(),f(B,{key:0,type:"warning",closable:""},{default:n(()=>a[12]||(a[12]=[y(" Thông tin chi tiết cần được người dùng bổ sung và chỉnh sửa ")])),_:1,__:[12]})):v("",!0)]),_:1},512)]),_:1})}}});export{ge as default};
