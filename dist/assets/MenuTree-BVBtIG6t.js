import{c as _,f as b,o as w,j as a,e as x,W as C,l as i,a8 as B,G as D,g as d,E as c,h as N,aC as R,p as m,M as k}from"./index-DYcU_f0W.js";import{_ as z,a as E}from"./ResAddOrEdit-Du7kSZir.js";import"./_isme_icons-VdKe73uL.js";import"./useForm-b0yQVc1X.js";import"./QuestionLabel-BpZlfaih.js";const V={class:"flex"},S={__name:"MenuTree",props:{treeData:{type:Array,default:()=>[]},currentMenu:{type:Object,default:()=>null}},emits:["refresh","update:currentMenu"],setup(s,{emit:h}){const n=h,r=_(""),f=_(null);async function p(t={}){var e;n("refresh"),n("update:currentMenu",null),(e=f.value)==null||e.handleOpen({action:"add",title:"Thêm menu",row:{...t,type:"MENU"},okText:"Lưu"})}function M(t,e,{action:o,node:u}){n("update:currentMenu",o==="select"?u:null)}function g({option:t}){return m("i",{class:`${t.icon}?mask text-16`})}function v({option:t}){return[m(c,{text:!0,type:"primary",title:"Thêm menu con",size:"tiny",onClick:k(()=>p({parentId:t.id}),["stop"])},{default:()=>"Thêm mới"}),m(c,{text:!0,type:"error",size:"tiny",style:"margin-left: 12px;",onClick:k(()=>T(t),["stop"])},{default:()=>"Xóa"})]}function T(t){$dialog.confirm({content:`Xác nhận xóa【${t.name}】?`,async confirm(){try{$message.loading("Đang xóa",{key:"deleteMenu"}),await E.deletePermission(t.id),$message.success("Xóa thành công",{key:"deleteMenu"}),n("refresh"),n("update:currentMenu",null)}catch(e){console.error(e),$message.destroy("deleteMenu")}}})}return(t,e)=>{const o=B,u=R,$=C;return w(),b("div",null,[a($,{vertical:"",size:12},{default:x(()=>{var l;return[e[4]||(e[4]=i("h3",null,"Menu",-1)),i("div",V,[a(o,{value:d(r),"onUpdate:value":e[0]||(e[0]=y=>D(r)?r.value=y:null),placeholder:"Tìm kiếm",clearable:""},null,8,["value"]),a(d(c),{class:"ml-12",type:"primary",onClick:e[1]||(e[1]=y=>p())},{default:x(()=>e[3]||(e[3]=[i("i",{class:"i-material-symbols:add mr-4 text-14"},null,-1),N(" Thêm mới ")])),_:1,__:[3]})]),a(u,{"show-irrelevant-nodes":!1,pattern:d(r),data:s.treeData,"selected-keys":[(l=s.currentMenu)==null?void 0:l.code],"render-prefix":g,"render-suffix":v,"on-update:selected-keys":M,"key-field":"code","label-field":"name","block-line":"","default-expand-all":""},null,8,["pattern","data","selected-keys"])]}),_:1,__:[4]}),a(z,{ref_key:"modalRef",ref:f,menus:s.treeData,onRefresh:e[2]||(e[2]=l=>n("refresh",l))},null,8,["menus"])])}}};export{S as default};
