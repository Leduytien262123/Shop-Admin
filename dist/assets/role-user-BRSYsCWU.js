import{_ as C}from"./CommonPage-r69Mp4tc.js";import{c as p,af as I,d as V,o as g,e as l,a as B,j as r,g as n,p as o,G as U,a8 as S,at as z,l as P,E as h,f as $,y as x,h as f,am as q,t as R,a4 as D,ap as E}from"./index-DYcU_f0W.js";import{f as G}from"./common-BF9XxHS1.js";import{_ as H}from"./index-DzJzXdOC.js";import{_ as y}from"./QueryItem-TlJu4VT3.js";import{a as _}from"./api-qSY_K89_.js";import"./TheFooter-BtZThfEk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppCard-kEEXouea.js";const j={class:"flex items-center"},A={key:0,class:"i-material-symbols:delete-outline mr-4 text-18"},K={key:0,class:"i-line-md:confirm-circle mr-4 text-18"},ee=Object.assign({name:"RoleUser"},{__name:"role-user",setup(O){const d=B(),m=p(null),s=p({});I(()=>{var t;(t=m.value)==null||t.handleSearch()});const v=[{label:"Nam",value:1},{label:"Nữ",value:2}],w=[{type:"selection",fixed:"left"},{title:"Ảnh đại diện",key:"avatar",width:80,render:({avatar:t})=>o(D,{size:"medium",src:t})},{title:"Tên người dùng",key:"username",width:150,ellipsis:{tooltip:!0}},{title:"Vai trò",key:"roles",width:200,ellipsis:{tooltip:!0},render:({roles:t})=>t!=null&&t.length?t.map((e,a)=>o(q,{type:"success",style:a>0?"margin-left: 8px;":""},{default:()=>e.name})):"Chưa có vai trò"},{title:"Giới tính",key:"gender",width:80,render:({gender:t})=>{var e;return((e=v.find(a=>t===a.value))==null?void 0:e.label)??""}},{title:"Thời gian tạo",key:"createDate",width:180,render(t){return o("span",G(t.createTime))}},{title:"Trạng thái",key:"enable",width:100,render:t=>o(E,{size:"small",rubberBand:!1,value:t.enable},{checked:()=>"Kích hoạt",unchecked:()=>"Tắt"})},{title:"Thao tác",key:"actions",width:100,align:"right",fixed:"right",hideInExcel:!0,render(t){var e;return(e=t.roles)!=null&&e.some(a=>a.id===+d.params.roleId)?o(h,{size:"small",type:"error",secondary:!0,onClick:()=>k([t.id])},{default:()=>"Hủy phân quyền",icon:()=>o("i",{class:"i-material-symbols:delete-outline text-14"})}):o(h,{size:"small",type:"primary",secondary:!0,onClick:()=>b([t.id])},{default:()=>"Phân quyền",icon:()=>o("i",{class:"i-line-md:confirm-circle text-14"})})}}],u=p([]);function N(t){u.value=t||[]}function b(t=u.value){const e=d.params.roleId;if(!e)return $message.error("Vai trò bất thường, vui lòng chọn lại vai trò");if(!t.length)return $message.error("Vui lòng chọn người dùng trước");$dialog.confirm({content:`Xác nhận phân quyền【${d.query.roleName}】?`,async confirm(){var a;try{await _.assignUsers(e,t),$message.success("Phân quyền thành công"),(a=m.value)==null||a.handleSearch()}catch(c){console.error(c)}}})}function k(t=u.value){const e=d.params.roleId;if(!e)return $message.error("Vai trò bất thường, vui lòng chọn lại vai trò");if(!t.length)return $message.error("Vui lòng chọn người dùng trước");$dialog.confirm({content:`Xác nhận hủy phân quyền【${d.query.roleName}】?`,async confirm(){var a;try{await _.removeUsers(e,t),$message.success("Hủy phân quyền thành công"),(a=m.value)==null||a.handleSearch()}catch(c){console.error(c)}}})}return(t,e)=>{const a=S,c=z,T=C;return g(),V(T,{back:""},{"title-suffix":l(()=>[r(n(q),{class:"ml-12",type:"warning"},{default:l(()=>[f(R(n(d).query.roleName),1)]),_:1})]),action:l(()=>[P("div",j,[r(n(h),{disabled:!n(u).length,type:"error",onClick:e[0]||(e[0]=i=>k())},{default:l(()=>[n(u).length?(g(),$("i",A)):x("",!0),e[6]||(e[6]=f(" Hủy phân quyền hàng loạt "))]),_:1,__:[6]},8,["disabled"]),r(n(h),{class:"ml-12",disabled:!n(u).length,type:"primary",onClick:e[1]||(e[1]=i=>b())},{default:l(()=>[n(u).length?(g(),$("i",K)):x("",!0),e[7]||(e[7]=f(" Phân quyền hàng loạt "))]),_:1,__:[7]},8,["disabled"])])]),default:l(()=>[r(n(H),{ref_key:"$table",ref:m,"query-items":n(s),"onUpdate:queryItems":e[5]||(e[5]=i=>U(s)?s.value=i:null),"scroll-x":1200,columns:w,"get-data":n(_).getAllUsers,onOnChecked:N},{default:l(()=>[r(n(y),{label:"Tên người dùng","label-width":90},{default:l(()=>[r(a,{value:n(s).username,"onUpdate:value":e[2]||(e[2]=i=>n(s).username=i),type:"text",placeholder:"Nhập tên người dùng",clearable:""},null,8,["value"])]),_:1}),r(n(y),{label:"Giới tính","label-width":50},{default:l(()=>[r(c,{value:n(s).gender,"onUpdate:value":e[3]||(e[3]=i=>n(s).gender=i),clearable:"",options:v},null,8,["value"])]),_:1}),r(n(y),{label:"Trạng thái","label-width":50},{default:l(()=>[r(c,{value:n(s).enable,"onUpdate:value":e[4]||(e[4]=i=>n(s).enable=i),clearable:"",options:[{label:"Kích hoạt",value:1},{label:"Tắt",value:0}]},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"])]),_:1})}}});export{ee as default};
