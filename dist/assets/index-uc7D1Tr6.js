import{_ as Y}from"./AppPage-C6BLEQQd.js";import{u as B}from"./useForm-b0yQVc1X.js";import{a5 as F,R as H,U as h,c as J,d as L,o as Q,e as l,j as a,ah as Z,W as ee,l as r,a4 as ae,g as t,t as f,E as ne,h as u,aU as te,aV as le,Y as w,a8 as se,G as oe,ao as re,aj as ue,at as ie,aX as de}from"./index-DYcU_f0W.js";import"./TheFooter-BtZThfEk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const k={changePassword:_=>F.post("/api/user/change-password",_),updateProfile:_=>F.put("/api/user/profile",_)},pe={class:"ml-20"},me={class:"flex items-center text-16"},fe={class:"ml-12 opacity-80"},_e={class:"mt-16 flex items-center"},ke={__name:"index",setup(_){var U,V,R;const s=H(),y={required:!0,message:"Đây là trường bắt buộc",trigger:["blur","change"]},[b]=h(),[T,i,q]=B();async function A(){await q(),await k.changePassword(i.value),$message.success("Sửa mật khẩu thành công"),g()}const m=J(s.avatar),[x]=h();async function C(){if(!m.value)return $message.error("Vui lòng nhập địa chỉ avatar"),!1;await k.updateProfile({id:s.userId,avatar:m.value}),$message.success("Sửa avatar thành công"),g()}const P=[{label:"Bí mật",value:0},{label:"Nam",value:1},{label:"Nữ",value:2}],[S]=h(),[E,o,G]=B({id:s.userId,nickName:s.nickName,gender:((U=s.userInfo)==null?void 0:U.gender)??0,address:(V=s.userInfo)==null?void 0:V.address,email:(R=s.userInfo)==null?void 0:R.email});async function O(){await G(),await k.updateProfile(o.value),$message.success("Sửa thông tin thành công"),g()}async function g(){const $=await de();s.setUser($)}return($,e)=>{const j=ae,v=ne,z=ee,N=Z,c=le,D=te,d=se,p=ue,I=re,K=ie,W=Y;return Q(),L(W,{"show-footer":""},{default:l(()=>[a(N,null,{default:l(()=>[a(z,{align:"center"},{default:l(()=>[a(j,{round:"",size:100,src:t(s).avatar},null,8,["src"]),r("div",pe,[r("div",me,[e[14]||(e[14]=r("span",null,"Tên người dùng:",-1)),r("span",fe,f(t(s).username),1),a(v,{class:"ml-32",type:"primary",text:"",onClick:e[0]||(e[0]=n=>t(b).open())},{default:l(()=>e[13]||(e[13]=[r("i",{class:"i-fe:edit mr-4"},null,-1),u(" Sửa mật khẩu ")])),_:1,__:[13]})]),r("div",_e,[a(v,{type:"primary",ghost:"",onClick:e[1]||(e[1]=n=>t(x).open())},{default:l(()=>e[15]||(e[15]=[u(" Thay đổi avatar ")])),_:1,__:[15]}),e[16]||(e[16]=r("span",{class:"ml-12 opacity-60"}," Thay đổi avatar chỉ hỗ trợ liên kết trực tuyến, không cung cấp chức năng tải lên hình ảnh, nếu cần có thể tự tích hợp! ",-1))])])]),_:1})]),_:1}),a(N,{class:"mt-20",title:"Thông tin cá nhân"},{"header-extra":l(()=>[a(v,{type:"primary",text:"",onClick:e[2]||(e[2]=n=>t(S).open())},{default:l(()=>e[17]||(e[17]=[r("i",{class:"i-fe:edit mr-4"},null,-1),u(" Sửa thông tin ")])),_:1,__:[17]})]),default:l(()=>[a(D,{"label-placement":"left","label-style":{width:"200px",textAlign:"center"},column:1,bordered:""},{default:l(()=>[a(c,{label:"Biệt danh"},{default:l(()=>[u(f(t(s).nickName),1)]),_:1}),a(c,{label:"Giới tính"},{default:l(()=>{var n;return[u(f(((n=P.find(X=>{var M;return X.value===((M=t(s).userInfo)==null?void 0:M.gender)}))==null?void 0:n.label)??"Không xác định"),1)]}),_:1}),a(c,{label:"Địa chỉ"},{default:l(()=>{var n;return[u(f((n=t(s).userInfo)==null?void 0:n.address),1)]}),_:1}),a(c,{label:"Email"},{default:l(()=>{var n;return[u(f((n=t(s).userInfo)==null?void 0:n.email),1)]}),_:1})]),_:1})]),_:1}),a(t(w),{ref_key:"avatarModalRef",ref:x,width:"420px",title:"Thay đổi avatar",onOk:e[4]||(e[4]=n=>C())},{default:l(()=>[a(d,{value:t(m),"onUpdate:value":e[3]||(e[3]=n=>oe(m)?m.value=n:null)},null,8,["value"])]),_:1},512),a(t(w),{ref_key:"pwdModalRef",ref:b,title:"Sửa mật khẩu",width:"420px",onOk:e[7]||(e[7]=n=>A())},{default:l(()=>[a(I,{ref_key:"pwdFormRef",ref:T,model:t(i),"label-placement":"left","require-mark-placement":"left"},{default:l(()=>[a(p,{label:"Mật khẩu cũ",path:"oldPassword",rule:y},{default:l(()=>[a(d,{value:t(i).oldPassword,"onUpdate:value":e[5]||(e[5]=n=>t(i).oldPassword=n),type:"password",placeholder:"Vui lòng nhập mật khẩu cũ","show-password-on":"mousedown"},null,8,["value"])]),_:1}),a(p,{label:"Mật khẩu mới",path:"newPassword",rule:y},{default:l(()=>[a(d,{value:t(i).newPassword,"onUpdate:value":e[6]||(e[6]=n=>t(i).newPassword=n),type:"password",placeholder:"Vui lòng nhập mật khẩu mới","show-password-on":"mousedown"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},512),a(t(w),{ref_key:"profileModalRef",ref:S,title:"Sửa thông tin",width:"420px",onOk:e[12]||(e[12]=n=>O())},{default:l(()=>[a(I,{ref_key:"profileFormRef",ref:E,model:t(o),"label-placement":"left"},{default:l(()=>[a(p,{label:"Biệt danh",path:"nickName"},{default:l(()=>[a(d,{value:t(o).nickName,"onUpdate:value":e[8]||(e[8]=n=>t(o).nickName=n),placeholder:"Vui lòng nhập biệt danh"},null,8,["value"])]),_:1}),a(p,{label:"Giới tính",path:"gender"},{default:l(()=>[a(K,{value:t(o).gender,"onUpdate:value":e[9]||(e[9]=n=>t(o).gender=n),options:P,placeholder:"Vui lòng chọn giới tính"},null,8,["value"])]),_:1}),a(p,{label:"Địa chỉ",path:"address"},{default:l(()=>[a(d,{value:t(o).address,"onUpdate:value":e[10]||(e[10]=n=>t(o).address=n),placeholder:"Vui lòng nhập địa chỉ"},null,8,["value"])]),_:1}),a(p,{label:"Email",path:"email"},{default:l(()=>[a(d,{value:t(o).email,"onUpdate:value":e[11]||(e[11]=n=>t(o).email=n),placeholder:"Vui lòng nhập email"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},512)]),_:1})}}};export{ke as default};
