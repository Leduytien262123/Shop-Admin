import{_ as j}from"./CommonPage-r69Mp4tc.js";import{u as G,c as _,J as R,w as z,af as A,d as F,o as I,e as l,j as t,ao as H,au as J,av as O,aj as Q,a8 as W,at as Z,aw as X,aq as Y,ar as ee,as as ae,l as N,W as te,E as ne,h as f,t as le,ah as ue,Z as m}from"./index-DYcU_f0W.js";const re={class:"flex items-center justify-center"},ie=Object.assign({name:"ProductAddEdit"},{__name:"ProductAddEdit",props:{id:{type:[String,Number],default:null}},setup(k){const c=k,U=G(),n=_({name:"",slug:"",sku:"",category_id:null,description:"",price:null,discount_price:null,meta_title:"",meta_keywords:"",meta_description:"",meta_image:[]}),p=R(()=>!!c.id),v=_([]),i=_(!1),C={name:[{required:!0,message:"Vui lòng nhập tên sản phẩm",trigger:["blur","input"]}],slug:[{required:!0,message:"Vui lòng nhập đường dẫn",trigger:["blur","input"]}],sku:[{required:!0,message:"Vui lòng nhập SKU",trigger:["blur","input"]}],category_id:[{required:!0,message:"Vui lòng chọn danh mục",trigger:["blur","change"]}],price:[{required:!0,trigger:["blur","input"],validator(a,e){return e?!0:new Error("Vui lòng nhập giá sản phẩm")}}],discount_price:[{required:!1,trigger:["blur","input"],validator(a,e){var s,r;if(e!=null&&e!==""){if(Number(e)>Number((s=n.value)==null?void 0:s.price))return new Error("Giá sale không được lớn hơn giá bán");if(Number(e)===Number((r=n.value)==null?void 0:r.price))return new Error("Giá sale không được bằng giá bán")}return!0}}]};function $(a){return a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-")}z(()=>n.value.name,a=>{a&&(n.value.slug=$(a))});const h=_(null);async function x(){var a;try{i.value=!0;const e={page:1,length:10},s=await m.getCategories(e);v.value=((a=s.data)==null?void 0:a.data.map(r=>({label:r.name,value:r.id})))||[]}catch{$message.error("Không thể tải danh sách danh mục")}finally{i.value=!1}}async function V(){if(c.id)try{i.value=!0;const a=await m.getProductById(c.id);a.data.success&&(n.value={name:a.data.data.name||"",description:a.data.data.description||"",slug:a.data.data.slug||"",is_active:a.data.data.is_active,category_id:a.data.data.category_id||null,sku:a.data.data.sku||"",price:a.data.data.price||null,discount_price:a.data.data.discount_price||null,show_menu:a.data.data.show_menu,show_home:a.data.data.show_home,show_footer:a.data.data.show_footer,meta_title:a.data.data.meta_title||"",meta_keywords:a.data.data.meta_keywords||"",meta_description:a.data.data.meta_description||"",meta_image:a.data.data.meta_image||[]})}catch(a){$message.error("Không thể tải thông tin danh mục"),console.error("Load category error:",a)}finally{i.value=!1}}A(()=>{x(),p.value&&V()});function g(){U.push("/product")}async function S(){var a;try{await((a=h.value)==null?void 0:a.validate()),i.value=!0,p.value?(await m.updateProduct(c.id,n.value),$message.success("Cập nhật sản phẩm thành công!")):(await m.createProduct(n.value),$message.success("Thêm sản phẩm thành công!")),g()}catch(e){if(e!=null&&e.errors)return;const s=p.value?"Cập nhật sản phẩm thất bại":"Thêm sản phẩm thất bại";$message.error(s),console.error("Save category error:",e)}finally{i.value=!1}}const y=a=>{const e=a.replace(/[^\d.]/g,"").trim();return/^\d+(\.(\d+)?)?$/.test(e)?Number(e):e===""?null:Number.NaN},b=a=>a==null||isNaN(a)?"":a.toLocaleString("vi-VN",{style:"currency",currency:"VND"});return(a,e)=>{const s=ne,r=W,o=Q,d=O,M=Z,w=X,q=J,B=ae,E=ee,P=Y,T=H,D=te,K=ue,L=j;return I(),F(L,null,{action:l(()=>[t(s,{onClick:g},{default:l(()=>e[11]||(e[11]=[N("i",{class:"i-material-symbols:arrow-back mr-4 text-18"},null,-1),f(" Quay lại ")])),_:1,__:[11]})]),default:l(()=>[t(K,{title:p.value?"Sửa sản phẩm":"Thêm sản phẩm"},{action:l(()=>[N("div",re,[t(D,null,{default:l(()=>[t(s,{onClick:g},{default:l(()=>e[12]||(e[12]=[f("Hủy")])),_:1,__:[12]}),t(s,{type:"primary",onClick:S},{default:l(()=>[f(le(p.value?"Cập nhật":"Lưu"),1)]),_:1})]),_:1})])]),default:l(()=>[t(T,{model:n.value,rules:C,ref_key:"formRef",ref:h},{default:l(()=>[t(q,{cols:"3","x-gap":"24","y-gap":"16"},{default:l(()=>[t(d,{span:"3"},{default:l(()=>[t(o,{label:"Tên sản phẩm",path:"name"},{default:l(()=>[t(r,{value:n.value.name,"onUpdate:value":e[0]||(e[0]=u=>n.value.name=u),placeholder:"Nhập tên sản phẩm"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:"2"},{default:l(()=>[t(o,{label:"Đường dẫn",path:"slug"},{default:l(()=>[t(r,{value:n.value.slug,"onUpdate:value":e[1]||(e[1]=u=>n.value.slug=u),placeholder:"Nhập đường dẫn"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:"1"},{default:l(()=>[t(o,{label:"Danh mục",path:"category_id"},{default:l(()=>[t(M,{value:n.value.category_id,"onUpdate:value":e[2]||(e[2]=u=>n.value.category_id=u),options:v.value,filterable:"",placeholder:"Chọn danh mục",clearable:""},null,8,["value","options"])]),_:1})]),_:1}),t(d,{span:"1"},{default:l(()=>[t(o,{label:"SKU",path:"sku"},{default:l(()=>[t(r,{value:n.value.sku,"onUpdate:value":e[3]||(e[3]=u=>n.value.sku=u),placeholder:"Nhập sku"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:"1"},{default:l(()=>[t(o,{label:"Giá",path:"price"},{default:l(()=>[t(w,{value:n.value.price,"onUpdate:value":e[4]||(e[4]=u=>n.value.price=u),"show-button":!1,parse:y,format:b,placeholder:"Nhập giá sản phẩm",class:"w-full"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:"1"},{default:l(()=>[t(o,{label:"Giá sale",path:"discount_price"},{default:l(()=>[t(w,{value:n.value.discount_price,"onUpdate:value":e[5]||(e[5]=u=>n.value.discount_price=u),"show-button":!1,parse:y,format:b,placeholder:"Nhập giá khuyến mãi",class:"w-full"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:"3"},{default:l(()=>[t(o,{label:"Mô tả",path:"description"},{default:l(()=>[t(r,{value:n.value.description,"onUpdate:value":e[6]||(e[6]=u=>n.value.description=u),type:"textarea",placeholder:"Nhập mô tả sản phẩm"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(P,{accordion:"",class:"custom-collapse-light-blue grow rd-5 my-15","arrow-placement":"right"},{default:l(()=>[t(E,{class:"custom-collapse-header-light-blue",title:"Thông tin Meta",name:"meta"},{default:l(()=>[t(o,{label:"Meta Title"},{default:l(()=>[t(r,{value:n.value.meta_title,"onUpdate:value":e[7]||(e[7]=u=>n.value.meta_title=u),placeholder:"Nhập meta title"},null,8,["value"])]),_:1}),t(o,{label:"Meta Keywords"},{default:l(()=>[t(r,{value:n.value.meta_keywords,"onUpdate:value":e[8]||(e[8]=u=>n.value.meta_keywords=u),placeholder:"Nhập meta keywords"},null,8,["value"])]),_:1}),t(o,{label:"Meta Description"},{default:l(()=>[t(r,{value:n.value.meta_description,"onUpdate:value":e[9]||(e[9]=u=>n.value.meta_description=u),type:"textarea",placeholder:"Nhập meta description"},null,8,["value"])]),_:1}),t(o,{label:"Meta Image"},{default:l(()=>[t(B,{"file-list":n.value.meta_image,"onUpdate:fileList":e[10]||(e[10]=u=>n.value.meta_image=u),max:1,"list-type":"image-card",disabled:i.value},null,8,["file-list","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})}}});export{ie as _};
